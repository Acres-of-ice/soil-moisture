function getUpdateStatus(){$.ajax({url:"/OTAstatus",type:"POST",data:"ota_update_status",dataType:"json",success:function(e){console.log("Received OTA update status:",e),$("#latest_firmware").text(e.compile_date+" - "+e.compile_time),1===e.ota_update_status?(seconds=10,otaRebootTimer()):-1===e.ota_update_status&&$("#ota_update_status").text("!!! Upload Error !!!")},error:function(e,t,a){console.error("Failed to get OTA update status:",a),$("#ota_update_status").text("Failed to get update status")}})}function otaRebootTimer(){document.getElementById("ota_update_status").innerHTML="Update Complete. Rebooting in: "+seconds,0==--seconds?(clearTimeout(otaTimerVar),window.location.reload()):otaTimerVar=setTimeout(otaRebootTimer,1e3)}function updateFirmware(){var e,t=document.getElementById("selected_file");t?t.files&&1===t.files.length?(e=t.files[0],(t=new FormData).append("file",e,e.name),$("#ota_update_status").text("Uploading "+e.name),$.ajax({url:"/OTAupdate",type:"POST",data:t,processData:!1,contentType:!1,xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",updateProgress,!1),e},success:function(e){console.log("Firmware update completed successfully"),$("#ota_update_status").text("Firmware update completed. Please wait for reboot."),getUpdateStatus()},error:function(e,t,a){console.error("Firmware update failed:",a),$("#ota_update_status").text("Firmware update failed. Please try again.")}})):alert("Select A File First"):console.error("File input element not found")}function updateProgress(e){e.lengthComputable?(e=e.loaded/e.total*100,$("#ota_update_status").text("Upload progress: "+e.toFixed(2)+"%"),getUpdateStatus()):(console.warn("Total size is unknown"),$("#ota_update_status").text("Upload in progress. Total size unknown."))}function getFileInfo(){var e=document.getElementById("selected_file");const t=document.getElementById("file_info");e&&t?e.files&&e.files[0]?(e=e.files[0],t.innerHTML="<h4>File: "+e.name+"<br>Size: "+e.size+" bytes</h4>"):t.innerHTML="<h4>No file selected</h4>":console.error("Required elements not found")}$(document).ready(function(){getUpdateStatus()});